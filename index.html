<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factorial Calculator with AI Insights</title>

    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for Inter font and overall page layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #22577A; /* Deep teal/jungle theme */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
        }
        .max-w-md {
            max-width: 28rem; /* Consistent with Tailwind's max-w-md */
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md border border-gray-200">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
            Factorial Calculator with AI Insights
        </h1>

        <!-- Input section for number -->
        <div class="mb-4">
            <label for="numberInput" class="block text-gray-700 text-sm font-semibold mb-2">
                Enter a non-negative integer:
            </label>
            <input
                type="number"
                id="numberInput"
                class="shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"
                placeholder="e.g., 5"
                min="0"
            >
        </div>

        <!-- Buttons -->
        <button
            id="calculateButton"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105 shadow-md mb-3"
        >
            Calculate Factorial
        </button>

        <button
            id="explainFactorialButton"
            class="w-full bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105 shadow-md mb-3"
        >
            Explain and Apply Factorials ✨
        </button>

        <button
            id="exploreConceptsButton"
            class="w-full bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105 shadow-md"
        >
            Explore Related Concepts ✨
        </button>

        <!-- Display areas -->
        <div id="resultDisplay" aria-live="polite" class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200 text-blue-800 text-lg font-semibold hidden"></div>
        <div id="stepsDisplay" aria-live="polite" class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 text-gray-700 text-base hidden overflow-x-auto"></div>
        <div id="llmExplanationDisplay" aria-live="polite" class="mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200 text-purple-800 text-base hidden"></div>
        <div id="llmConceptsDisplay" aria-live="polite" class="mt-4 p-4 bg-teal-50 rounded-lg border border-teal-200 text-teal-800 text-base hidden"></div>
        <div id="messageBox" aria-live="polite" class="mt-4 p-4 bg-red-100 rounded-lg border border-red-300 text-red-700 text-base hidden"></div>

        <!-- Loading indicator -->
        <div id="loadingIndicator" class="mt-4 hidden text-center text-gray-600">
            <div class="animate-spin inline-block w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full"></div>
            <p class="ml-2 inline-block">Generating explanation...</p>
        </div>
    </div>

    <script>
        // Get references
        const numberInput = document.getElementById('numberInput');
        const calculateButton = document.getElementById('calculateButton');
        const explainFactorialButton = document.getElementById('explainFactorialButton');
        const exploreConceptsButton = document.getElementById('exploreConceptsButton');
        const resultDisplay = document.getElementById('resultDisplay');
        const stepsDisplay = document.getElementById('stepsDisplay');
        const llmExplanationDisplay = document.getElementById('llmExplanationDisplay');
        const llmConceptsDisplay = document.getElementById('llmConceptsDisplay');
        const messageBox = document.getElementById('messageBox');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // IMPORTANT: API key security
        const GEMINI_API_KEY = ''; // <-- Leave blank for security. Use a backend proxy.
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

        function clearDisplays() {
            resultDisplay.classList.add('hidden');
            stepsDisplay.classList.add('hidden');
            llmExplanationDisplay.classList.add('hidden');
            llmConceptsDisplay.classList.add('hidden');
            messageBox.classList.add('hidden');

            resultDisplay.textContent = '';
            stepsDisplay.textContent = '';
            llmExplanationDisplay.textContent = '';
            llmConceptsDisplay.textContent = '';
            messageBox.textContent = '';
            loadingIndicator.classList.add('hidden');
        }

        function showMessage(message, type = 'info') {
            clearDisplays();
            messageBox.textContent = message;
            messageBox.classList.remove('hidden');
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-300', 'text-red-700');
            } else {
                messageBox.classList.add('bg-blue-100', 'border-blue-300', 'text-blue-800');
            }
        }

        function calculateFactorial(n) {
            if (typeof n !== 'number' || n < 0 || !Number.isInteger(n)) {
                return "Input must be a non-negative integer.";
            }
            if (n > 20) {
                return "Number too large. Please enter a number ≤ 20.";
            }
            return n === 0 ? 1 : Array.from({ length: n }, (_, i) => i + 1).reduce((a, b) => a * b, 1);
        }

        function solveFactorialSteps(n) {
            if (typeof n !== 'number' || n < 0 || !Number.isInteger(n)) {
                return "Invalid input for factorial steps.";
            }
            if (n === 0) {
                return "0! = 1";
            }
            const steps = `${n}! = ${Array.from({ length: n }, (_, i) => n - i).join(' x ')} = ${calculateFactorial(n)}`;
            return steps;
        }

        calculateButton.addEventListener('click', () => {
            clearDisplays();
            const inputValue = numberInput.value;
            const number = parseInt(inputValue, 10);

            if (inputValue.trim() === '') {
                showMessage("Please enter a number.", 'error');
                return;
            }
            if (isNaN(number) || !Number.isInteger(number)) {
                showMessage("Invalid input. Please enter a whole number.", 'error');
                return;
            }
            if (number < 0) {
                showMessage("Factorial is not defined for negative numbers.", 'error');
                return;
            }

            const factorialResult = calculateFactorial(number);
            resultDisplay.textContent = `The factorial of ${number} is: ${factorialResult}`;
            resultDisplay.classList.remove('hidden');

            if (number <= 10) {
                stepsDisplay.textContent = solveFactorialSteps(number);
                stepsDisplay.classList.remove('hidden');
            } else {
                stepsDisplay.textContent = "Step-by-step solution not shown for numbers >10 for readability.";
                stepsDisplay.classList.remove('hidden');
            }
        });

        async function fetchGeminiResponse(prompt, displayElement, loadingText) {
            clearDisplays();
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.querySelector('p').textContent = loadingText;

            if (!GEMINI_API_KEY) {
                showMessage("API Key is missing. Set up a backend proxy for security.", 'error');
                loadingIndicator.classList.add('hidden');
                return;
            }

            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    displayElement.innerHTML = text.replace(/\n/g, '<br>');
                    displayElement.classList.remove('hidden');
                } else {
                    showMessage("Could not generate response. Try again.", 'error');
                }
            } catch (error) {
                console.error(`Error calling Gemini API:`, error);
                showMessage("Error fetching data. Check network or backend proxy.", 'error');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        explainFactorialButton.addEventListener('click', () => {
            const prompt = "Explain what a factorial is in simple terms and give some real-world examples.";
            fetchGeminiResponse(prompt, llmExplanationDisplay, 'Generating explanation...');
        });

        exploreConceptsButton.addEventListener('click', () => {
            const prompt = "Explain permutations and combinations and how they relate to factorials.";
            fetchGeminiResponse(prompt, llmConceptsDisplay, 'Generating related concepts...');
        });

        numberInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                calculateButton.click();
            }
        });
    </script>
</body>
</html>

